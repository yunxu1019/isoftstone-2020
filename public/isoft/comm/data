0cuObject,Array,JSON,keys,location,extend,parseKV,RegExp,serialize,unescape,isString,undefined,document,console,isEmpty,Promise,Error,Date,cross,Function,enrich,localStorage,sessionStorage,a,e,c,u,G,g,v,H,w,I,x,J,K,m,L,h,y,M,N,i,O,n,ofunction P(a){var c=a.source,d=a.head,b=a.body;return b instanceof e?b.map(function(b){var a={};return b.map(function(f,g){var b=d[g],e=c[b][f];a[b]=e}),a}):[]}function Q(f){if(!f instanceof e)return;var b={};f.map(function(h){for(var d in h){var f=h[d];if(f instanceof a)continue;b[d]||(b[d]={inc:0});var e=b[d],g=c.stringify(f);g in e||(e[g]=e.inc++)}});var d=u(b),g=f.map(function(a){return d.map(function(d){var e=c.stringify(a[d]);return b[d][e]})});return d.map(function(d){var a=b[d];delete a.inc,b[d]=u(a).map(c.parse)}),{source:b,head:d,body:g}}function R(c){var a,b=['id','name','icon'];return c.replace(/#(.*?)$/,function(d,c){return c=c.split('&'),c.forEach(function(f,h){if(f){var c=f.split('=').reverse(),d=c[0],e=c[1],g=e===void 0?b[h]||d:e;a||(a={}),a[g]=d}}),''}),a}function z(a,f,h){if(!f)return a;if(a instanceof e)return a.map(function(a){return z(a,f,h)});b=g({},a&&a.querySelector?null:a);for(var c in f){var d=f[c];c in b||(d in b?(b[c]=b[d],delete b[d]):b[c]=B(a,d,h))}return b}function A(b,c){c===void 0&&(c='?');var a=b.indexOf(c);return a<0||a>=b.length-1?void 0:v(b.slice(a+1))}function S(c,d){var e=/([\s\S]*?)/.source,b=[],f=c.url.replace(/[\?\#][\s\S]*$/,'').replace(/[\.\*\+\-\[\]\{\}\(\)\\\/\!\<\>\^]/g,'\\$&').replace(/\:\w+/,function(a){return b.push(a.slice(1)),e}),a={};return d=d.replace(/[\?#]*$/g,function(b){return b.split(/[&#\?]+/).forEach(function(e){var b=e.split('='),c=b[0],d=b[1];a[c]=d}),''}).replace(new H('^'+f+'$','ig'),function(){var c=arguments;b.forEach(function(b,d){a[b]=c[d+1]})}),a=w(a),c.id+'?'+a}function B(a,b,g){if(g===void 0&&(g={}),a&&a.querySelector){if(!b)return a;b=I(b);var d=/^(\[\]|,)|(\[\]|,)$/g;if(d.test(b))return[].concat.apply([],a.querySelectorAll(b.replace(d,'')));var d=/[\|\?\!\/]/;if(d.test(b))var h=b.split(d),e=h[0],c=h[1];else var e=b;if(e&&(a=a.querySelector(e)),a&&c){var i=/\:/;if(i.test(c)){var j=c.split(i),c=j[0],f=j[1];f=g[f]}return a=a.getAttribute(c)||a[c],x(a)&&/\|/.test(b)&&(a=a.trim()),f&&(a=S(f,a)),a}return a}return b&&b.split('.').forEach(function(b){a!==null&&a!==J&&b in a&&(a=a[b])}),a}function T(b){var d=b.method,i=d===void 0?'':d,e=b.url,f=e===void 0?'':e,g=b.id,c=g===void 0?'':g,h=b.name,j=h===void 0?'':h,k=b.comment,a=[];return c=c.replace(/\?(.+?)$/,function(c,b){return b=b.split('&'),b.forEach(function(e){if(e){var c=e.split('='),b=c[0],d=c[1],f=d===void 0?b:d;a[b]||a.push(b),a[b]=f}}),''}),f.replace(/[\?\#][\s\S]*$/,'').replace(/\:\w+/g,function(b){a[b]||(a.push(b),a[b]=b)}),{method:i,url:f,id:c,name:j,comment:k,required:a}}function U(a,b){s.test(a.url)||b&&(/^\.([\?\#][\s\S]*)?$/.test(a.url)?a.url=b+a.url.replace(/^\./,''):a.url=b+a.url),a.method=a.method.toLowerCase()}function C(j){function k(a){if(U(a,h),g.call(b,a.id)){var c=b[a.id];m.warn('\u591a\u6b21\u8bbe\u7f6e\u7684id\u76f8\u540c\u7684api:%c'+a.id,'color:red'),m.log('['+a.name+']('+c.method+' '+a.url+')\r\n \u88ab ['+a.name+']('+c.method+' '+c.url+') \u8986\u76d6')}return b[a.id]=a,a}var b={},g={}.hasOwnProperty,h,d=j;for(var e in d){var c=e.split(/\s+/).filter(function(a){return s.test(a)})[0];if(!c)continue;h=/(https?\:)?|\.?\//i.test(c)?c:'';var f=d[e],i=a.keys(f).map(function(a){return a+' '+f[a]});E.string('id method url name comment',i).map(T).map(k)}return b}var D=this&&this.__extends||function(b){return b=function(c,d){return b=a.setPrototypeOf||{__proto__:[]}instanceof e&&function(a,b){a.__proto__=b}||function(c,b){for(var a in b)b.hasOwnProperty(a)&&(c[a]=b[a])},b(c,d)},function(d,c){function e(){this.constructor=d}b(d,c),d.prototype=c===null?a.create(c):(e.prototype=c.prototype,new e)}}(),p=G.pathname,f={},q={},E={string:function(c,a){if(a instanceof e){var b=c.split(/(?:\s+|,)/);a=a.map(function(a){if(typeof a==='string'){var c={};return a.split(/(?:\s+|,)/).map(function(a,d){return c[b[d]]=a}),c}return a})}return a},'function':function(a,b,c){return a(b,c)}},F=function(a){function b(){var b=a!==null&&a.apply(this,arguments)||this;return b.totalCount=0,b.data=[],b.is_errored=null,b.error_message=null,b.is_loading=!0,b.is_readonly=null,b.loading_promise=null,b}return D(b,a),b}(e),r=function(a){if(/^\s*([\{\[]|"|true|\d|false|null)/.test(a))return c.parse(a);var b=K.implementation.createHTMLDocument('');return/^\s*\</i.test(a)?(b.documentElement.innerHTML=a,b):a},s=/^(https?\:\/\/|\.?\/)/i,t,j,d={loadAfterConfig:function(b,c){var d=this;return this.getApi(b).then(function(i){if(/\?/.test(b)&&(c=a.assign({},A(b),c),b=b.replace(/\?[\s\S]*$/,'')),/\:/.test(b)){var g=a.assign({},c),f=A(b,':');for(var h in f){var e=f[h];e in c&&(g[h]=c[e]),e in f||delete g[e]}}return d.fromApi(i,c)})},fromApi:function(a,c){var d=a.url;if(a.reauired){var b=a.reauired;if(c||(b=b.filter(function(a){return L(c[a])})),b.length)return m.log('\u8df3\u8fc7\u4e86\u7f3a\u5c11\u53c2\u6570\u7684\u8bf7\u6c42:'+a.uid+' '+a.name+' '+a.url+'\r\n\u7f3a\u5c11\u53c2\u6570\uff1a'+b.join(', ')),h.resolve()}return this.loadIgnoreConfig(a.method,d,c,a.root)},getApi:function(b){return this.getConfigPromise().then(function(d){b=b.replace(/[\?\:][\s\S]*$/,'');var c=d[b];if(!c)throw new y('\u6ca1\u6709\u627e\u5230\u5bf9\u5e94\u7684\u63a5\u53e3 id '+b+'.');return a.assign({},c,{root:d})})},loadIgnoreConfig:function(k,x,b,y){var d=/[\:\|\/\~\!\?]/.exec(k);d?d=d.index:d=k.length;var n=k.slice(0,d).toLowerCase(),o=n.replace(/\W+$/g,''),e=x.replace(/#[\s\S]*$/,'');if(b=g({},b),/\?/.test(e))var f=e.replace(/^[\s\S]*?\?/,'');var l=[],m=e.replace(/\?[\s\S]*$/,'').replace(/\:[a-z]\w*/i,function(a){return a=a.slice(1),l.push(a),b[a]||''}),p={}.hasOwnProperty;if(f){var j=v(f);for(var i in j)p.call(j,i)&&p.call(b,i)&&(j[i]=b[i],l.push(i));f=w(j),e=m+'?'+f}else e=m;l.forEach(function(a){return delete b[a]});var s=o+' '+m,a=q[s],t=c.stringify(b),u=+new M;if(!a||u-a.time>60||t!==a.params||a.search!==f){var a=new h(function(c,a){N(o,e).send(b).done(function(a){c(a.response||a.responseText)}).error(function(b){try{a(r(b.response||b.responseText||b.statusText||b.status))}catch(b){a(b)}})});a.search=f,a.params=t,a.time=u,q[s]=a}return a.then(function(a){return/\*$/.test(n)?a:z(B(r(a),k.slice(d+1)),R(x),y)})},getConfigPromise:function(){if(!j){if(!t)throw new y('\u6ca1\u6709\u6307\u5b9a\u914d\u7f6e\u6587\u4ef6\u7684\u8def\u5f84\uff0c\u8bf7\u4f7f\u7528data.loadConfig\u52a0\u8f7d\u914d\u7f6e');j=this.loadIgnoreConfig('get',t).then(C)}return j}},k=0,l=function(){return k++===k&&(k=1),k},b={decodeStructure:P,encodeStructure:Q,loading_count:0,loadConfig:function(a){return a&&(t=a,j=null),d.getConfigPromise()},from:function(b,c,d){return c instanceof i&&(d=c,c={}),b instanceof a?this.fromApi(b,c):/^\.*\/|\.\w+$/.test(b)?this.fromURL(b,d):this.asyncInstance(b,c,d)},enrich:function(c,e){if(c===void 0&&(c=j),!c)return;if(x(c))c=d.loadIgnoreConfig('get',c).then(C);else if(!(c instanceof h)){if(!(c instanceof a))return;c=h.resolve(c)}return O({from:function(a,b){return c.then(function(e){var c=e[a];return d.fromApi(c,b)})},queue:function(a,e,f){a=a.slice(0),c.then(function(c){return new h(function(f){var c=function(e){if(!a.length)return f(e);var g=a.pop(),h=b[g];d.fromApi(h,e).then(c)};c(e)})})}})},fromApi:function(f,h,g){var b=this,a=g instanceof i?l():0;a&&this.removeInstance(a);var c=f.url,e=this.getInstance(a||c);return e.loading_promise=d.fromApi(f,h).then(function(d){return a?(b.setInstance(a,g(d),!1),b.removeInstance(a)):b.setInstance(c,d),d}),e},fromURL:function(c,f){var b=this,a=f instanceof i?l():0;a&&this.removeInstance(a);var e=this.getInstance(a||c);return e.loading_promise=d.loadIgnoreConfig('get',c).then(function(d){return a?(b.setInstance(a,f(d),!1),b.removeInstance(a)):b.setInstance(c,d),d}),e},asyncInstance:function(f,h,g){var e=this,b=g instanceof i||h?l():0;b&&this.removeInstance(b);var c=this.getInstance(b||f);c.is_loading=!0,this.loading_count++;var j=c.loading_promise=d.loadAfterConfig(f,h).then(function(a){return e.loading_count--,b?(e.setInstance(b,g instanceof i?g(a):a,!1),e.removeInstance(b)):e.setInstance(f,a),a});return j['catch'](function(b){e.loading_count--,c.is_errored=!0,b instanceof a?a.assign(c,b):c.error=b}),c},getInstance:function(a,d){if(d===void 0&&(d=!1),!f[a]){var b=f[a]=new F,e=a+p;g(b,c.parse(n.getItem(e))),d||g(b,c.parse(o.getItem(e))),b.is_loading=!1}return f[a]},removeInstance:function(a){delete f[a],n.removeItem(a),o.removeItem(a)},setInstance:function(b,d,a){a===void 0&&(a=0);var g=this.getInstance(b);this.rebuildInstance(g,d);var e=b+p;return a!==!1&&o.setItem(e,c.stringify(d)),a&&n.setItem(e,c.stringify(d)),f[b]},rebuildInstance:function(b,d,c){if(c===void 0&&(c=b),b===d)return;b.splice(0,b.length),a.keys(c).forEach(function(a){b[a]===c[a]&&delete b[a]}),g(b,d)}};return b